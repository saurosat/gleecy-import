<?xml version="1.0" encoding="UTF-8"?>

<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd"
        default-menu-title="Publish Data" default-menu-index="1" >
    <transition name="sendEntitiesToFO">
        <parameter name="entityName" required="true" />
        <actions>
            <script>
                import org.moqui.entity.EntityValue
                import io.gleecy.foi.HttpTopic
                System.out.println(entityName);
            </script>
            <set field="resultList" from="[]" />
            <if condition="entityName == 'ALL'"><then>
                <set field="resultList" from="[
                    'mantle.product.category.ProductCategory',
                    'mantle.product.category.ProductCategoryRollup',
                    'mantle.product.category.ProductCategoryMember',
                    'mantle.product.Product',
                    'mantle.product.ProductPrice',
                    'mantle.product.feature.ProductFeature',
                    'mantle.product.feature.ProductFeatureAppl',
                    'mantle.product.ProductAssoc',
                    'mantle.product.store.ProductStore',
                    'mantle.product.store.ProductStorePromotion'
                ]"/>
            </then><else-if condition="entityName != '_NA_'">
                <set field="resultList" from="[entityName]" />
            </else-if></if>
            <iterate list="resultList" entry="eName">
                <log message="Entity name: ${eName}" />
                <entity-find entity-name="${eName}" list="eList" />
                <script>
                    System.out.println("Found " + eList.size() + " entities")
                        for(EntityValue ev : eList) {
                            HttpTopic topic = ec.getTool("HttpTopic", HttpTopic.class, ev, "update")
                        if(topic != null) {
                            topic.send()
                        }
                    }
                </script>
            </iterate>
        </actions>
        <default-response url="."/>
    </transition>
    <widgets>
        <form-single name="SendToFO" transition="sendEntitiesToFO">
            <field name="entityName"><default-field title="Entity Name">
                <drop-down>
                    <option key="_NA_" text="None" />
                    <option key="ALL" text="All" />
                    <option key="mantle.product.category.ProductCategory" text="Product Categories" />
                    <option key="mantle.product.category.ProductCategoryRollup" text="Product Category Rollup" />
                    <option key="mantle.product.category.ProductCategoryMember" text="Product Category Members" />
                    <option key="mantle.product.Product" text="Products" />
                    <option key="mantle.product.ProductPrice" text="Product Prices" />
                    <option key="mantle.product.feature.ProductFeature" text="Product Features" />
                    <option key="mantle.product.feature.ProductFeatureAppl" text="Product Feature Application" />
                    <option key="mantle.product.ProductAssoc" text="Product Association" />
                    <option key="mantle.product.store.ProductStore" text="Product Store" />
                    <option key="mantle.product.store.ProductStorePromotion" text="Store Promotions" />
                </drop-down></default-field>
            </field>
            <field name="submitButton"><default-field title="Submit"><submit/></default-field></field>
        </form-single>
    </widgets>
</screen>